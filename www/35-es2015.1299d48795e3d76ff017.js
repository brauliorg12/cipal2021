(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{EdD2:function(t,n,i){"use strict";i.r(n),i.d(n,"ChatPageModule",(function(){return A}));var e=i("ofXK"),o=i("3Pt+"),c=i("TEn/"),a=i("tyNb"),r=i("mrSG"),s=i("HDdC"),d=i("D0XW"),g=i("Y7HM");function l(t){const{subscriber:n,counter:i,period:e}=t;n.next(i),this.schedule({subscriber:n,counter:i+1,period:e},e)}class h{dameJSON(){return JSON.parse(JSON.stringify(this))}}var u=i("fXoL"),p=i("on2l"),m=i("tk/3");const f="https://vps-1663776-x.dattaweb.com";let b=(()=>{class t{constructor(t,n){this.http=t,this.usuarioService=n}enviarChat(t){const n=new m.c({"x-token":this.usuarioService.token});return this.http.post(f+"/chat",t,{headers:n})}recibirChat(t){const n=new m.c({"x-token":this.usuarioService.token});return this.http.post(f+"/chat/recibir",{user_id:t},{headers:n})}}return t.\u0275fac=function(n){return new(n||t)(u.hc(m.a),u.hc(p.a))},t.\u0275prov=u.Ub({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var M=i("e8h1");const v=["IonContent"];function _(t,n){if(1&t&&(u.dc(0,"ion-buttons",9),u.dc(1,"div",10),u.dc(2,"div",11),u.Lc(3," Est\xe1s chateando con: "),u.cc(),u.dc(4,"div",12),u.Lc(5),u.cc(),u.cc(),u.dc(6,"ion-avatar",13),u.Zb(7,"img",14),u.cc(),u.cc()),2&t){const t=u.pc();u.Mb(5),u.Nc(" ",t.usuario_recibe.nombre," ")}}function C(t,n){if(1&t&&(u.bc(0),u.dc(1,"ion-label",15),u.dc(2,"b"),u.Lc(3),u.cc(),u.cc(),u.ac()),2&t){const t=u.pc();u.Mb(3),u.Nc("No tienes mensajes con ",t.usuario_recibe.nombre," a\xfan.")}}function x(t,n){1&t&&(u.bc(0),u.dc(1,"ion-label",15),u.dc(2,"b"),u.Lc(3,"Error reintentar!"),u.cc(),u.cc(),u.ac())}function P(t,n){1&t&&(u.bc(0),u.dc(1,"ion-row",16),u.Zb(2,"ion-spinner",17),u.cc(),u.ac())}const O=function(t){return{slideInLeft:t}};function w(t,n){if(1&t&&(u.dc(0,"ion-row",26),u.dc(1,"ion-col",27),u.dc(2,"div",28),u.dc(3,"ion-label",4),u.dc(4,"div",29),u.dc(5,"p",30),u.Lc(6),u.cc(),u.cc(),u.cc(),u.cc(),u.cc(),u.cc()),2&t){const t=u.pc(2),n=t.index,i=t.$implicit,e=u.pc(2);u.Mb(2),u.vc("ngClass",u.yc(2,O,n==e.msgList.length-1)),u.Mb(4),u.Mc(i.mensaje)}}function y(t,n){1&t&&u.Zb(0,"ion-icon",35)}function k(t,n){if(1&t&&(u.dc(0,"ion-row"),u.dc(1,"ion-col",31),u.dc(2,"div",32),u.dc(3,"p",33),u.Lc(4),u.qc(5,"date"),u.cc(),u.Kc(6,y,1,0,"ion-icon",34),u.cc(),u.cc(),u.cc()),2&t){const t=u.pc(2).$implicit;u.Mb(4),u.Mc(u.sc(5,2,t.fecha," d/M/yy h:mm")),u.Mb(2),u.vc("ngIf",t.visto)}}function L(t,n){if(1&t){const t=u.ec();u.dc(0,"ion-item-sliding",null,21),u.dc(2,"ion-item",22),u.Kc(3,w,7,4,"ion-row",23),u.cc(),u.Kc(4,k,7,5,"ion-row",7),u.dc(5,"ion-item-options",24),u.lc("ionSwipe",(function(){u.Dc(t);const n=u.Cc(1);return u.pc(3).closeTime(n)})),u.dc(6,"ion-item-option",25),u.dc(7,"ion-text"),u.Lc(8),u.cc(),u.cc(),u.cc(),u.cc()}if(2&t){const t=u.pc(),n=t.$implicit,i=t.index,e=u.pc(2);u.Mb(3),u.vc("ngIf",n.usuario_cre!==e.usuario._id),u.Mb(1),u.vc("ngIf",e.msgList[i+1]&&e.msgList[i+1].usuario_cre!=n.usuario_cre||!e.msgList[i+1]),u.Mb(2),u.vc("ngClass",e.msgList[i+1]&&e.msgList[i+1].usuario_cre!=n.usuario_cre||!e.msgList[i+1]?"":"time-center"),u.Mb(2),u.Mc(n.fecha)}}function I(t,n){1&t&&(u.dc(0,"ion-row"),u.Zb(1,"ion-col",39),u.cc())}const j=function(t){return{slideInRight:t}};function D(t,n){if(1&t){const t=u.ec();u.dc(0,"ion-item-sliding",null,36),u.dc(2,"ion-item",22),u.dc(3,"ion-row",26),u.dc(4,"ion-col",37),u.dc(5,"div",38),u.dc(6,"ion-label",4),u.dc(7,"div",29),u.dc(8,"p",30),u.Lc(9),u.cc(),u.cc(),u.cc(),u.cc(),u.cc(),u.cc(),u.cc(),u.Kc(10,I,2,0,"ion-row",7),u.dc(11,"ion-item-options",24),u.lc("ionSwipe",(function(){u.Dc(t);const n=u.Cc(1);return u.pc(3).closeTime(n)})),u.dc(12,"ion-item-option",25),u.dc(13,"ion-text"),u.Lc(14),u.qc(15,"date"),u.cc(),u.cc(),u.cc(),u.cc()}if(2&t){const t=u.pc(),n=t.index,i=t.$implicit,e=u.pc(2);u.Mb(5),u.vc("ngClass",u.yc(8,j,n==e.msgList.length-1)),u.Mb(4),u.Mc(i.mensaje),u.Mb(1),u.vc("ngIf",e.msgList[n+1]&&e.msgList[n+1].usuario!=i.usuario||!e.msgList[n+1]),u.Mb(2),u.vc("ngClass",e.msgList[n+1]&&e.msgList[n+1].usuario!=i.usuario||!e.msgList[n+1]?"":"time-center"),u.Mb(2),u.Mc(u.sc(15,5,i.fecha," d/M/yy h:mm"))}}function S(t,n){1&t&&u.Zb(0,"ion-row",40)}function z(t,n){if(1&t&&(u.dc(0,"div"),u.Kc(1,L,9,4,"ion-item-sliding",7),u.Kc(2,D,16,10,"ion-item-sliding",7),u.Kc(3,S,1,0,"ion-row",20),u.cc()),2&t){const t=n.$implicit,i=n.index,e=u.pc(2);u.Mb(1),u.vc("ngIf",t.usuario_cre!==e.usuario._id),u.Mb(1),u.vc("ngIf",t.usuario_cre===e.usuario._id),u.Mb(1),u.vc("ngIf",e.msgList[i+1]&&e.msgList[i+1].usuario==t.usuario)}}function K(t,n){if(1&t&&(u.bc(0),u.dc(1,"ion-list",18),u.Kc(2,z,4,3,"div",19),u.cc(),u.ac()),2&t){const t=u.pc();u.Mb(2),u.vc("ngForOf",t.msgList)}}function T(t,n){if(1&t){const t=u.ec();u.dc(0,"ion-footer",41),u.dc(1,"ion-toolbar"),u.dc(2,"ion-item"),u.dc(3,"ion-input",42),u.lc("ngModelChange",(function(n){return u.Dc(t),u.pc().userInput=n}))("keypress",(function(n){return u.Dc(t),u.pc().userTyping(n)})),u.cc(),u.dc(4,"ion-buttons",13),u.dc(5,"ion-button",43),u.lc("click",(function(){return u.Dc(t),u.pc().prepareMsg()}))("mousedown",(function(n){return u.Dc(t),u.pc().something(n)})),u.Zb(6,"ion-icon",44),u.cc(),u.cc(),u.cc(),u.cc(),u.cc()}if(2&t){const t=u.pc();u.Mb(3),u.vc("ngModel",t.userInput)}}const R=[{path:"",component:(()=>{class t{constructor(t,n,i,e){this.activRoute=t,this.usuarioService=n,this.chatService=i,this.storage=e,this.userInput="",this.intervallTimer=function(t=0,n=d.a){return(!Object(g.a)(t)||t<0)&&(t=0),n&&"function"==typeof n.schedule||(n=d.a),new s.a(i=>(i.add(n.schedule(l,t,{subscriber:i,counter:0,period:t})),i))}(5e3),this.status="loading",this.storage.get("usuariocache").then(t=>Object(r.a)(this,void 0,void 0,(function*(){t&&(this.usuario=t)})),t=>{})}ionViewDidLeave(){this.subscription.unsubscribe()}ngOnInit(){this.param=this.activRoute.snapshot.params.user,this.loadPage(this.param),this.realTime(this.param)}realTime(t){this.subscription=this.intervallTimer.subscribe(()=>this.chatService.recibirChat(t).subscribe(t=>{t.ok&&this.length_global!==t.data.length&&(console.log("realtime"),this.length_global=t.data.length,this.msgList=t.data,this.scrollDown())}))}loadPage(t){this.usuarioService.getUser(t).toPromise().then(n=>Object(r.a)(this,void 0,void 0,(function*(){n.ok&&(console.log(n),this.usuario_recibe=yield n.usuario,this.recibirMsj(t))})))}closeTime(t){console.log("closeTime"),t.close()}prepareMsg(t){if(""!==this.userInput){const t=new h;t.mensaje=this.userInput,t.usuario_recibe=this.usuario_recibe._id,t.usuario_envia=this.usuario._id,t.estado=!0,t.visto=!1,this.chatService.enviarChat(t).toPromise().then(t=>Object(r.a)(this,void 0,void 0,(function*(){console.log(t),t.ok&&this.recibirMsj(this.param)}))),this.userInput="",this.startTyping=!1}}scrollDown(){setTimeout(()=>{console.log("scroll"),this.content.scrollToBottom(200)},250)}userTyping(t){this.scrollDown(),13===t.keyCode&&this.prepareMsg()}something(t){t.preventDefault(),console.log(t)}recibirMsj(t){this.param&&this.chatService.recibirChat(t).subscribe(t=>{console.log("Mensajes",t),t.ok?(this.length_global=t.data.length,this.msgList=t.data,this.scrollDown(),console.log(t),this.status="ok",0===t.data.length&&(this.status="cero")):this.status="error"})}}return t.\u0275fac=function(n){return new(n||t)(u.Yb(a.a),u.Yb(p.a),u.Yb(b),u.Yb(M.b))},t.\u0275cmp=u.Sb({type:t,selectors:[["app-chat"]],viewQuery:function(t,n){var i;1&t&&u.Gc(v,!0),2&t&&u.Bc(i=u.mc())&&(n.content=i.first)},decls:15,vars:6,consts:[[1,"ion-text-center","header_home"],["color","primary"],["slot","start"],["mode","md","type","button","color","light","icon","arrow-back","defaultHref","/"],["color","light"],["slot","end","class","user-info",4,"ngIf"],["IonContent",""],[4,"ngIf"],["translucent","",4,"ngIf"],["slot","end",1,"user-info"],[1,"header_padding"],[1,"header-mood"],[1,"header-name"],["slot","end"],["src","assets/img/av-1.png"],["color","medium",1,"label_add","center"],[1,"center"],["name","crescent","color","primary"],[1,"max-width"],[4,"ngFor","ngForOf"],["class","thin-gap",4,"ngIf"],["itemSliding",""],[1,"chat-item"],["class","chat-row",4,"ngIf"],["side","end",3,"ionSwipe"],[3,"ngClass"],[1,"chat-row"],[1,"right","ion-no-padding"],[1,"imageAvatarRight","animated","superfast",3,"ngClass"],[1,"chatDiv"],["padding","",1,"text-wrap"],["size","12",1,"col_fecha_izquierda"],[1,"timer-right"],[1,"timer-rightP"],["name","done-all","class","first-tick",4,"ngIf"],["name","done-all",1,"first-tick"],["itemSliding2",""],["size","12",1,"left","ion-no-padding"],[1,"imageAvatarLeft","animated","superfast",3,"ngClass"],["size","12",1,"col_fecha_derecha"],[1,"thin-gap"],["translucent",""],["type","text","placeholder","Escriba su mensaje...",3,"ngModel","ngModelChange","keypress"],["color","primary",3,"disabled","click","mousedown"],["name","send","slot","icon-only"]],template:function(t,n){1&t&&(u.dc(0,"ion-header",0),u.dc(1,"ion-toolbar",1),u.dc(2,"ion-buttons",2),u.Lc(3," \xa0 "),u.Zb(4,"ion-back-button",3),u.dc(5,"ion-title",4),u.Lc(6,"Chat "),u.cc(),u.cc(),u.Kc(7,_,8,1,"ion-buttons",5),u.cc(),u.cc(),u.dc(8,"ion-content",null,6),u.Kc(10,C,4,1,"ng-container",7),u.Kc(11,x,4,0,"ng-container",7),u.Kc(12,P,3,0,"ng-container",7),u.Kc(13,K,3,1,"ng-container",7),u.cc(),u.Kc(14,T,7,1,"ion-footer",8)),2&t&&(u.Mb(7),u.vc("ngIf","ok"===n.status||"cero"===n.status),u.Mb(3),u.vc("ngIf","cero"===n.status),u.Mb(1),u.vc("ngIf","error"===n.status),u.Mb(1),u.vc("ngIf","loading"===n.status),u.Mb(1),u.vc("ngIf","ok"===n.status),u.Mb(1),u.vc("ngIf","ok"===n.status||"cero"===n.status))},directives:[c.t,c.Z,c.j,c.f,c.g,c.X,e.k,c.q,c.e,c.D,c.K,c.S,c.E,e.j,c.C,c.x,c.B,c.A,e.i,c.U,c.p,c.u,c.r,c.w,c.lb,o.l,o.o,c.i],pipes:[e.d],styles:['ion-avatar[_ngcontent-%COMP%]{width:40px!important;height:40px!important;border-radius:20px;background-position:50%;background-size:cover;border:2px solid #eee}ion-item-option[_ngcontent-%COMP%]{background:#e8ebf3;--background:#e8ebf3;max-height:calc(100% - 24px)}ion-item-option.time-center[_ngcontent-%COMP%]{max-height:100%}.full-content[_ngcontent-%COMP%]{height:100%;width:100%;padding:0 5px;overflow:scroll}.timer-right[_ngcontent-%COMP%]{display:flex;justify-content:right;align-items:center;width:100%}.timer-Left[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;width:100%}.timer-rightP[_ngcontent-%COMP%]{margin:0 0 0 8px}.timer-LeftP[_ngcontent-%COMP%], .timer-rightP[_ngcontent-%COMP%]{font-size:11px;color:hsla(0,0%,50.2%,.6588235294117647)}.timer-LeftP[_ngcontent-%COMP%]{margin:0 4px 0 0}.col_fecha_izquierda[_ngcontent-%COMP%]{justify-content:left;padding-right:.5rem;display:grid}.col_fecha_derecha[_ngcontent-%COMP%]{justify-content:right;padding-right:.5rem;display:grid}ion-footer[_ngcontent-%COMP%]{background:#e8eaf3;display:flex;align-items:center;min-height:60px}ion-fab-button[_ngcontent-%COMP%]{--background:#37a9d8!important;--background-activated:#37a9d8!important}ion-header[_ngcontent-%COMP%]{--background:#5b2573}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{border-bottom:2px solid #00c8be}ion-item[_ngcontent-%COMP%]{--background:transparent;--inner-border-width:0}.chat-item-user[_ngcontent-%COMP%]{--padding-start:0;--inner-padding-end:0}.chat-item-user.image-item[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding-right:0}.chat-item-user.image-item[_ngcontent-%COMP%]   .chatDiv[_ngcontent-%COMP%]{max-width:100vw;background:no-repeat}.chat-item-user.image-item[_ngcontent-%COMP%]   .chatDiv[_ngcontent-%COMP%]:after{content:"";width:0;height:0;background:transparent;position:absolute;bottom:0;z-index:10;right:0;border-color:transparent #e8ebf3 #e8ebf3 transparent;border-style:solid;border-width:10px}.chat-item[_ngcontent-%COMP%], .chat-item-sender[_ngcontent-%COMP%]{--padding-start:0;--inner-padding-end:0}.chat-item-sender.image-item[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding-right:0}.chat-item-sender.image-item[_ngcontent-%COMP%]   .chatDiv[_ngcontent-%COMP%]{max-width:100vw;background:no-repeat}.chat-item-sender.image-item[_ngcontent-%COMP%]   .chatDiv[_ngcontent-%COMP%]:after{content:"";width:0;height:0;background:transparent;position:absolute;bottom:0;z-index:10;left:0;border-color:transparent transparent #e8ebf3 #e8ebf3;border-style:solid;border-width:10px}ion-list[_ngcontent-%COMP%]{background:transparent;padding-top:20px;padding-bottom:20px;margin-bottom:0}.imageAvatarRight[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:flex-end;overflow:hidden}.imageAvatarRight[_ngcontent-%COMP%]   .chatDiv[_ngcontent-%COMP%]{text-align:justify;position:relative;max-width:72vw;background:#00c8be;color:#fff;text-align:left}.imageAvatarRight[_ngcontent-%COMP%]   .chatDiv[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;text-align:left;padding:14px}.imageAvatarLeft[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:flex-end;overflow:hidden}.imageAvatarLeft[_ngcontent-%COMP%]   .chatDiv[_ngcontent-%COMP%]{text-align:left;position:relative;max-width:72vw;background:#56a9d5;color:#fff;font-weight:500}.imageAvatarLeft[_ngcontent-%COMP%]   .chatDiv[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;padding:14px}ion-fab-button[_ngcontent-%COMP%]{width:47px!important;height:47px!important}ion-fab[_ngcontent-%COMP%]{bottom:-54px!important}.footerIcon[_ngcontent-%COMP%]{color:#666}ion-input[_ngcontent-%COMP%]{--placeholder-color:#aaa}.chatDivLoader[_ngcontent-%COMP%]{position:relative;background:#fff;border-radius:16px;min-width:80px;max-width:80px;align-items:center;color:#fff;padding:2px;display:flex;justify-content:center}ion-text[_ngcontent-%COMP%]{font-size:12px;color:#56a8d5;padding:4px 8px;height:24px;border-radius:12px;line-height:16px;border:1px solid #56a8d5}ion-col[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.hidden[_ngcontent-%COMP%]{visibility:hidden}.loading-col[_ngcontent-%COMP%], .right[_ngcontent-%COMP%]{justify-content:flex-start;padding-left:10px}.left[_ngcontent-%COMP%]{justify-content:flex-end;padding-right:10px}.full-width[_ngcontent-%COMP%]{width:100%}.input-box[_ngcontent-%COMP%]{color:#444;--padding-start:50px!important}.fabCamera_button[_ngcontent-%COMP%]{--background:rgba(55,169,216,0)!important;--box-shadow:none;--background-activated:rgba(55,169,216,0)!important;--color:var(--ion-color-medium)}.header-image[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:20px;background-position:50%;background-size:cover;border:2px solid #eee}.header-meta[_ngcontent-%COMP%]{padding-right:10px}.header-mood[_ngcontent-%COMP%]{font-size:14px;color:#fff;padding-bottom:.2rem}.header_padding[_ngcontent-%COMP%]{padding-right:.5rem}.header-name[_ngcontent-%COMP%]{font-size:16px;color:#fff}.left-time[_ngcontent-%COMP%]{padding-right:20px;justify-content:flex-end;padding-bottom:0}.right-time[_ngcontent-%COMP%]{padding-left:20px;justify-content:flex-start;padding-bottom:0}.user-info[_ngcontent-%COMP%]{padding-right:12px}.chat-row[_ngcontent-%COMP%]{width:100%}.mb-100[_ngcontent-%COMP%]{margin-bottom:60px}.thin-gap[_ngcontent-%COMP%]{margin-top:5px}.timer-right-condition[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;width:100%}.timer-right-conditionP[_ngcontent-%COMP%]{font-size:11px;margin-right:8px;color:hsla(0,0%,50.2%,.6588235294117647);margin-top:0}.chatDivVideo[_ngcontent-%COMP%]{max-width:100vw;background:no-repeat}.chatDivMap[_ngcontent-%COMP%]{width:100vw;height:200px;max-width:100vw}.chat-item-user-video[_ngcontent-%COMP%]{--padding-start:0;--inner-padding-end:0}.chat-item-user-video.image-item[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding-right:0}.chat-item-user-video.image-item[_ngcontent-%COMP%]   .chatDiv[_ngcontent-%COMP%]{max-width:100vw;background:#000}.chat-item-user-video.image-item[_ngcontent-%COMP%]   .chatDiv[_ngcontent-%COMP%]:after{content:"";width:0;height:0;background:transparent;position:absolute;bottom:-1px;z-index:10;right:0;border-color:transparent #e8ebf3 #e8ebf3 transparent;border-style:solid;border-width:10px 11px}.animated[_ngcontent-%COMP%]{-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-fill-mode:both;animation-fill-mode:both}.superfast[_ngcontent-%COMP%]{-webkit-animation-duration:.25s;animation-duration:.25s}@-webkit-keyframes slideInLeft{0%{transform:translate3d(-100%,0,0);visibility:visible}to{transform:translateZ(0)}}@keyframes slideInLeft{0%{transform:translate3d(-100%,0,0);visibility:visible}to{transform:translateZ(0)}}.slideInLeft[_ngcontent-%COMP%]{-webkit-animation-name:slideInLeft;animation-name:slideInLeft}@-webkit-keyframes slideInRight{0%{transform:translate3d(100%,0,0);visibility:visible}to{transform:translateZ(0)}}@keyframes slideInRight{0%{transform:translate3d(100%,0,0);visibility:visible}to{transform:translateZ(0)}}.slideInRight[_ngcontent-%COMP%]{-webkit-animation-name:slideInRight;animation-name:slideInRight}']}),t})()}];let Z=(()=>{class t{}return t.\u0275mod=u.Wb({type:t}),t.\u0275inj=u.Vb({factory:function(n){return new(n||t)},imports:[[a.j.forChild(R)],a.j]}),t})(),A=(()=>{class t{}return t.\u0275mod=u.Wb({type:t}),t.\u0275inj=u.Vb({factory:function(n){return new(n||t)},imports:[[e.b,o.f,c.ab,Z]]}),t})()}}]);